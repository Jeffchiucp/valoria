/* So this is how we load valoria.
This is it. We're fetching all the things
in the dimension and using their
idea code to bring them to the dimension.*/

//Get User and Dimension
window.thisUsername = $('#username').text();
window.thisDimensionKey = $('#dimension').text();

$('.' + thisDimensionKey).remove();

window.gun = Gun([`${window.location.href}gun`])

window.dimensionGun = gun.get('dimension').get(thisDimensionKey);

//Create Dimension Element
window.thisDimension = document.createElement('div');
thisDimension.classList.add(thisDimensionKey);
thisDimension.tabIndex = 1;
$(thisDimension).css({
  width : "100%",
  height : "100%",
  position : "absolute",
  display : "flex",
  justifyContent : "center",
  alignItems : "center",
  zIndex : 0,
  background : "url('https://i.imgur.com/TbwEvfU.png')",
  backgroundColor : "#000000"
})
$('body').append(thisDimension);

window.ideas = {};

//Load Dimension Data
axios.get('/dimension/' + thisDimensionKey).then((dimensionRes) => {
  let dimension = dimensionRes.data;
  //Load the use idea
  axios.get('/dimension/' + thisDimensionKey + "/idea/use").then((useRes) => {
    new Function(useRes.data.content)();

    //Use all the default ideas
    dimension.defaultIdeas.forEach((idea) => {
      if(idea != 'start' && idea != 'use'){
        use(idea);
      }
    })

    //Lets load the things in this dimension
    window.things = {};
    dimensionRes.data.things.forEach((thingKey) => {
      axios.get('/dimension/' + thisDimensionKey + '/thing/' + thingKey).then((thingRes) => {
        let thingContent;
        if(thingRes.data.content){
          thingContent = JSON.parse(thingRes.data.content);
        }
        things[thingKey] = new Thing(thingRes.data.kind);
        things[thingKey].key = thingKey;
        things[thingKey].creator = thingRes.data.creator;
        things[thingKey].dimension = thingRes.data.dimension;
        things[thingKey].content = thingContent;
        things[thingKey].build();
      })
    })
  })
})
